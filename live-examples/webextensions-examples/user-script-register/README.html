<h1 id="user-script-registration">User script registration</h1>
<p>This extension demonstrates the <a href="https://wiki.developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts/Register"><code>browser.userScripts.register()</code></a> API.</p>
<p>The extension includes an <a href="https://wiki.developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts">API script</a> (<code>customUserScriptAPIs.js</code>) that enables user scripts to make use of <code>browser.storage.local</code>.</p>
<p>To enable a user script to be specified and registered, this extension includes a sidebar action. The sidebar enables you to define the following properties that control the execution of a registered script, with default values provided:</p>
<ul>
<li>the host pattern <code>*://*.org/*</code>, which loads the script into any HTTP or HTTPS pages on a <code>.org</code> domain.</li>
<li>script code that replaces the content of the pattern matched page with the message “This page has been eaten”. The script also uses the API script stubs to save and recall the URL of each page “eaten”. Information on the last and current “eaten” page is then included in the “eaten” message.</li>
<li>a script ID that is stored in the user script metadata and then used in the API script to store separate values for each registered script.</li>
</ul>
<p>All other properties use their default value.</p>
<p>Clicking “Register script” registers the script by calling <code>browser.userScripts.register()</code>.</p>
<p>In this example, only one script can be registered at a time: registering a new script unregisters the active script. The extension does this by keeping a reference to the <code>RegisteredUserScript</code> object returned from <code>browser.userScripts.register()</code>: this object provides the <code>unregister()</code> method.</p>
<p>To try the extension, click “Register script” with the defaults and load http://example.org/ or https://www.mozilla.org/. Then change the pattern or the code and reload these or related pages.</p>
