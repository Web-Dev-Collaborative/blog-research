<h1 id="pokedex-hooks-phase-3">Pokedex Hooks: Phase 3</h1>
<p>At this point, you’ve converted a class based project with the <code>useState</code> and <code>useEffect</code> hooks and converted a Redux-based project with the <code>useSelector</code> and <code>useDispatch</code> hooks. Now you’ll work on of a project which stores it’s state in the <code>&lt;App&gt;</code> component and threads the state down through multiple components by using <code>props</code>. You’ll be adding a <code>Context</code> in an <code>AppWithContext</code> component and will use <code>useContext</code> to access this context in all the components that need access.</p>
<p>Your instructor will supply you with the phase 3 starter project.</p>
<h2 id="the-backend">The backend</h2>
<p>This application talks to the very same pokedex backend app you’ve been using for the first two phases. You can leave the backend running if you already have it up and going.</p>
<h2 id="a-note-on-your-phase-1-and-2-project">A note on your phase 1 and 2 project</h2>
<p>Remember to shutdown your Redux based Pokedex app before you start this one or you may get an error about port 3000 being already in use.</p>
<h2 id="exploring-this-application">Exploring this application</h2>
<p>If you look around this application you’ll see it is mostly the same as the other pokedex apps we’ve been using. But it does have a few differences.</p>
<p>The first major difference is that there’s no Redux here. This app is simply storing it’s state in the <code>&lt;App&gt;</code> component and prop threading it down to every component under it that needs it.</p>
<p>Also you may notice that the fetch calls have been moved into modules in the <code>fetches</code> folder. This is a good way to keep your <code>useEffect</code> hooks in the components small.</p>
<p>If you look at the <code>&lt;App&gt;</code> component you’ll see it uses several <code>useState()</code> hooks, including one for the <code>token</code> and one for the <code>pokemon</code> list. It then passes those state variables and state functions down to lots of difference components, including <code>&lt;LoginPanel&gt;</code>, <code>&lt;PokemonBrowser&gt;</code>, etc.</p>
<p>What we want to do is put a context at the top level of our component tree, and get all of these components, including <code>&lt;App&gt;</code> to use the context instead.</p>
<h2 id="using-the-usecontext-hook-to-manage-application-state">Using the <code>useContext</code> hook to manage application state</h2>
<p>Previously, you created a Redux cycle to pass Pokedex information through your components. Now you’ll manage your application’s global information by using React Context instead! Remember that you still generate context with the <code>createContext</code> function, just as you would for class components. You also still use <code>&lt;Context.Provider&gt;</code> components to set the <code>value</code> of your context object.</p>
<p>Think of how you would make use of the <code>useContext</code> hook instead of Redux’s <code>connect()</code> function to pass slices of state as well as functions to update the global state.</p>
<h3 id="providing-context">Providing context</h3>
<p>Begin by creating a <code>PokemonContext</code> with the <code>createContext</code> function from React. If you don’t remember how to do this, check the Context documentation.</p>
<p>Then you’ll need to set the context value with a <code>&lt;Context.Provider&gt;</code> component by making a wrapper Provider component for the <code>App</code> component. Create an <code>AppWithContext</code> component as the wrapper component for <code>App</code>.</p>
<p>Make the following <code>useState</code> hooks and then add them to the <code>Context.Provider</code> value attribute:</p>
<ul>
<li>pokemon - This defaults to an empty array and will hold our pokemon</li>
<li>setPokemon - This is the function to update our pokemon</li>
<li>selectedPokemon - This holds the currently selected pokemon</li>
<li>setSelectedPokemon - This is to update the currently selected pokemon</li>
<li>token - This default to an empty string and will hold our login token</li>
<li>setToken - This is the function to update out token</li>
</ul>
<blockquote>
<p>Hint: It might be cleaner to build a small POJO to hold these instead of trying to cram all of these into the <code>value</code> attribute.</p>
</blockquote>
<p>Remember to import the <code>App</code> component and render it inside of the <code>&lt;Context.Provider&gt;</code>!</p>
<h3 id="rendering-your-wrapper-component">Rendering your wrapper component</h3>
<p>After you have set up the wrapper component, make sure to replace the <code>App</code> that is rendered in your <code>index.js</code> file with your new <code>AppWithContext</code> wrapper component. Now it’s time to change your application from being a state-based application to a context-based application.</p>
<h3 id="consuming-context-with-the-usecontext-hook">Consuming context with the useContext hook</h3>
<p>Your application’s consuming components should access the <code>PokemonContext</code> through using the <code>useContext</code> hook. Feel free to reference the [Hooks API Reference] to revisit the documentation on the <code>useContext</code> hook. As a reminder, the <code>useContext</code> hook replaces the <code>static contextType</code> property of class components:</p>
<h3 id="usecontext">useContext</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// Receive access to context with React Hooks in function components:</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> context <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">// Access context with the `useContext` hook:</span></a>
<a class="sourceLine" id="cb1-5" title="5">context</a></code></pre></div>
<p>Now it’s time to set up how your application components <em>consume</em> the <code>PokemonContext</code>!</p>
<h3 id="note-on-debugging-your-context">Note on debugging your context</h3>
<p>Feel free to console log the <code>context</code> in any component you are accessing the <code>PokemonContext</code>. You can also use the <code>debugger</code> command to pause execution right after you do <code>useContext</code> to view what’s currently stored in the context.</p>
<p>This way upon the mounting of a component, you have a general sense of the <code>context</code> object the component is receiving. Since you’ll be using Hooks and Context to manage your user authentication, you may need to clear your <code>localStorage</code> items to reset your application to allow for future testing and debugging. As a reminder, you can go to the <code>Application</code> tab of your developer tools to find a <code>Storage</code> section with your <code>Local Storage</code> items. There you can right click to delete all items stored in <code>localStorage</code>.</p>
<h3 id="refactor-the-components">Refactor the components</h3>
<p>You’ll want to refactor the following components to use the context:</p>
<ul>
<li><code>App</code></li>
<li><code>PokemonBrowser</code></li>
<li><code>PokemonDetail</code></li>
<li><code>PokemonForm</code></li>
<li><code>LoginPanel</code></li>
<li><code>LogoutButton</code></li>
</ul>
<p>As with the other refactoring you’ve done today, do one component at a time.</p>
<p>Once you add the code to pull the information out of the context, make sure you remove any props that conflict, and also change the parent component to not pass down those props anymore!</p>
<blockquote>
<p>Tip, when you use <code>useContext</code> it might be helpful to destructure only the bit you need from the context, so for instance, if you only needed the token, you might do this : <code>const { token } = useContext(PokemonContext);</code> Doing it this way might mean you have to change less code in the components, since the context variables will be the same as the ones the app previously destructured from <code>props</code></p>
</blockquote>
<h3 id="app">App</h3>
<p>Take a moment to compare the code that currently lives in your <code>AppWithContext</code> with the code that lives in you <code>App</code> component. Notice how there is a lot of duplicated logic. This is because you <code>App</code> was the main component managing your application’s state-based information. Now that you have moved all the logic to your <code>AppWithContext</code> component, you can refactor your <code>App</code> component to simply use the <code>useContext</code> hook to pass the <code>token</code> value to the <code>&lt;LoginPanel&gt;</code> it renders. You can also remove all other props passed through the routes. Your refactored <code>App</code> component should look something like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// App.js</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span>  <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">const</span> <span class="op">{</span> token<span class="op">,</span> setToken <span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">    (<span class="kw">async</span>() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-7" title="7">      <span class="kw">const</span> localToken <span class="op">=</span> <span class="va">window</span>.<span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&quot;token&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="cf">if</span> (localToken) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-9" title="9">        <span class="at">setToken</span>(localToken)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">      <span class="op">}</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="op">}</span>)()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="op">},</span>[setToken])<span class="op">;</span></a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14">  <span class="kw">const</span> needLogin <span class="op">=</span> <span class="op">!</span>token<span class="op">;</span></a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="op">&lt;</span>BrowserRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-18" title="18">      <span class="op">&lt;</span>Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-19" title="19">        <span class="op">&lt;</span>Route</a>
<a class="sourceLine" id="cb2-20" title="20">          path<span class="op">=</span><span class="st">&quot;/login&quot;</span></a>
<a class="sourceLine" id="cb2-21" title="21">          render<span class="op">={</span>(props) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb2-22" title="22">            <span class="op">&lt;</span>LoginPanel <span class="op">{</span>...<span class="at">props</span><span class="op">}</span>/&gt;</a>
<a class="sourceLine" id="cb2-23" title="23">          )<span class="op">}</span></a>
<a class="sourceLine" id="cb2-24" title="24">        /&gt;</a>
<a class="sourceLine" id="cb2-25" title="25">        <span class="op">&lt;</span>PrivateRoute</a>
<a class="sourceLine" id="cb2-26" title="26">          path<span class="op">=</span><span class="st">&quot;/&quot;</span></a>
<a class="sourceLine" id="cb2-27" title="27">          exact<span class="op">={</span><span class="kw">true</span><span class="op">}</span></a>
<a class="sourceLine" id="cb2-28" title="28">          needLogin<span class="op">={</span>needLogin<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb2-29" title="29">          <span class="op">&lt;</span>PokemonBrowser</a>
<a class="sourceLine" id="cb2-30" title="30">          /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-31" title="31">        &lt;/PrivateRoute<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-32" title="32">        <span class="op">&lt;</span>PrivateRoute</a>
<a class="sourceLine" id="cb2-33" title="33">          path<span class="op">=</span><span class="st">&quot;/pokemon/:pokemonId&quot;</span></a>
<a class="sourceLine" id="cb2-34" title="34">          exact<span class="op">={</span><span class="kw">true</span><span class="op">}</span></a>
<a class="sourceLine" id="cb2-35" title="35">          needLogin<span class="op">={</span>needLogin<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb2-36" title="36">          <span class="op">&lt;</span>PokemonBrowser</a>
<a class="sourceLine" id="cb2-37" title="37">          /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-38" title="38">        &lt;/PrivateRoute<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-39" title="39">      &lt;/Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-40" title="40">    &lt;/BrowserRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-41" title="41">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="im">export</span> <span class="im">default</span> App<span class="op">;</span></a></code></pre></div>
<p>You’ll notice that the <code>App</code> component doesn’t even need the <code>pokemon</code> and <code>setPokemon</code> anymore so we aren’t destructuring them from the context anymore! This is because inside of <code>&lt;PokemonBrowser&gt;</code> it’ll use the context to get the <code>pokemon</code> and <code>setPokemon</code>. No more prop threading!</p>
<h3 id="loginpanel">LoginPanel</h3>
<p>Let’s begin by refactoring your <code>LoginPanel</code> component! The <code>LoginPanel</code> should access the context’s <code>setToken</code> function <code>token</code> value.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> <span class="op">{</span>token<span class="op">,</span> setToken<span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="va">console</span>.<span class="at">log</span>(authToken)<span class="op">;</span></a></code></pre></div>
<h3 id="the-rest-of-the-components">The rest of the components</h3>
<p>Now go ahead and refactor the rest of the component using what you’ve learned. The process should be very similar. Follow these steps.</p>
<ol type="1">
<li>Determine what props the component is using.</li>
<li>If those props are stored in the context, remove them from <code>props</code> and add a <code>useContext</code> call instead.</li>
<li>Visit the parent component to remove any props attributes being passed down.</li>
</ol>
<p>After you have finished refactoring your context based hooks application, compare it to the earlier redux solution. Using Redux instead of Context results in a lot of boilerplate code in your application. React 16 revamped the Context API and deemed the <code>useContext</code> hook as a basic hook to improve React’s built-in state management. For simple applications <code>Context</code> can be a good option without having to rely on Redux, but you do lose the nice Redux debugging tools to inspect the state of your application. In your career you may encounter apps using either approach or even applications that use a combination of both.</p>
