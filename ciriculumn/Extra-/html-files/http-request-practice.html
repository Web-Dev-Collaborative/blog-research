<h1 id="http-request-practice">HTTP Request Practice</h1>
<h3 id="projected-time">Projected Time</h3>
<p>1.5 hour total</p>
<ul>
<li>Lesson: 45 min</li>
<li>Guided Practice: 10 min</li>
<li>Independent Practice: 15 min</li>
<li>Check for Understanding: 20 min</li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li><a href="/api/intro-to-http.md">Intro to HTTP</a></li>
</ul>
<h3 id="motivation">Motivation</h3>
<p>HTTP is the most common way you will retrieve anything from the internet: usually web pages or API data (see <a href="./api/apis-and-json.md">API &amp; JSON lesson</a>). It’s the backbone of the web. Since HTTP is so simple and versatile (it’s just text!), you can make requests lots of different ways.</p>
<h3 id="objectives">Objectives</h3>
<p><strong>Participants will be able to:</strong></p>
<ul>
<li>Make HTTP requests using a variety of mechanisms.</li>
</ul>
<h3 id="specific-things-to-learn">Specific Things to Learn</h3>
<ul>
<li>Basics of an HTTP Request</li>
<li>Six different ways to make an HTTP request - Postman (Mac GUI app) - curl - XMLHttpRequest (aka AJAX) in the browser - fetch (promises) in the browser - http.request in Node.js - fetch in Node.js</li>
</ul>
<h3 id="lesson">Lesson</h3>
<p>HTTP requests are text-based messages used to request a resource from a server. In these lessons we’ll focus on GET requests but there are other methods as well, such as POST, which is used on a form to submit data or in an API to save data.</p>
<ul>
<li><a href="https://docs.google.com/presentation/d/1UI4XmRD3usA67ddO_8VLU3vAR4zfFXWZZaiUSKNLCXM/edit#slide=id.p">Google Slides</a></li>
</ul>
<h4 id="postman---time-api">Postman - Time API</h4>
<p>Open Postman to make a new GET request.</p>
<p><code>https://worldtimeapi.org/api/ip</code></p>
<p><img src="postman-time-example.png" /></p>
<p>Inspect the result. If you want you can try out other types of requests listed on the <a href="http://worldtimeapi.org/">API doc</a>. Varying the URL will give you different data.</p>
<h4 id="curl---time-api">curl - Time API</h4>
<p>Now let’s make the same request using the <a href="https://en.wikipedia.org/wiki/CURL"><code>curl</code></a> command line unix utility.</p>
<p>Find the <code>Code</code> link in Postman on the right.</p>
<p><img src="postman-code.png" /></p>
<p>This will allow us to make the same request using a variety of other tools. Choose <code>cURL</code> from the dropdown.</p>
<p>You will see something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">curl</span> -X GET \</a>
<a class="sourceLine" id="cb1-2" title="2">  https://worldtimeapi.org/api/ip \</a>
<a class="sourceLine" id="cb1-3" title="3">  -H <span class="st">&#39;Accept: */*&#39;</span> \</a>
<a class="sourceLine" id="cb1-4" title="4">  -H <span class="st">&#39;Accept-Encoding: gzip, deflate&#39;</span> \</a>
<a class="sourceLine" id="cb1-5" title="5">  -H <span class="st">&#39;Cache-Control: no-cache&#39;</span> \</a>
<a class="sourceLine" id="cb1-6" title="6">  -H <span class="st">&#39;Connection: keep-alive&#39;</span> \</a>
<a class="sourceLine" id="cb1-7" title="7">  -H <span class="st">&#39;Host: worldtimeapi.org&#39;</span> \</a>
<a class="sourceLine" id="cb1-8" title="8">  -H <span class="st">&#39;Postman-Token: 8d3f63db-f54f-48fe-997f-f1f678464644,f75b0ac1-ec5e-489d-af1a-fdefc80d56f9&#39;</span> \</a>
<a class="sourceLine" id="cb1-9" title="9">  -H <span class="st">&#39;User-Agent: PostmanRuntime/7.19.0&#39;</span> \</a>
<a class="sourceLine" id="cb1-10" title="10">  -H <span class="st">&#39;cache-control: no-cache&#39;</span></a></code></pre></div>
<p>Copy this entire snippet and paste into Terminal.</p>
<p>You should see output like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span><span class="dt">&quot;week_number&quot;</span><span class="fu">:</span><span class="dv">47</span><span class="fu">,</span><span class="dt">&quot;utc_offset&quot;</span><span class="fu">:</span><span class="st">&quot;-08:00&quot;</span><span class="fu">,</span><span class="dt">&quot;utc_datetime&quot;</span><span class="fu">:</span><span class="st">&quot;2019-11-20T17:08:24.181139+00:00&quot;</span><span class="fu">,</span><span class="dt">&quot;unixtime&quot;</span><span class="fu">:</span><span class="dv">1574269704</span><span class="fu">,</span><span class="dt">&quot;timezone&quot;</span><span class="fu">:</span><span class="st">&quot;America/Los_Angeles&quot;</span><span class="fu">,</span><span class="dt">&quot;raw_offset&quot;</span><span class="fu">:</span><span class="dv">-28800</span><span class="fu">,</span><span class="dt">&quot;dst_until&quot;</span><span class="fu">:</span><span class="kw">null</span><span class="fu">,</span><span class="dt">&quot;dst_offset&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">,</span><span class="dt">&quot;dst_from&quot;</span><span class="fu">:</span><span class="kw">null</span><span class="fu">,</span><span class="dt">&quot;dst&quot;</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">&quot;day_of_year&quot;</span><span class="fu">:</span><span class="dv">324</span><span class="fu">,</span><span class="dt">&quot;day_of_week&quot;</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">&quot;datetime&quot;</span><span class="fu">:</span><span class="st">&quot;2019-11-20T09:08:24.181139-08:00&quot;</span><span class="fu">,</span><span class="dt">&quot;client_ip&quot;</span><span class="fu">:</span><span class="st">&quot;69.181.221.255&quot;</span><span class="fu">,</span><span class="dt">&quot;abbreviation&quot;</span><span class="fu">:</span><span class="st">&quot;PST&quot;</span><span class="fu">}</span><span class="er">%</span></a></code></pre></div>
<h5 id="note-about-http-headers">Note about HTTP Headers</h5>
<p>You might wonder where all those <code>-H</code> lines are coming from when we only put the URL in Postman. As we learned in the HTTP video, headers tell the server additional options. They are like <em>flags</em> in a command line tool or <em>parameters</em> in a JavaScript function. In the case of HTTP, they are almost always optional.</p>
<ul>
<li>Copy <em>only</em> the first two lines and paste it into terminal (do not include the second <code>\</code>)</li>
<li>The result should be the same</li>
</ul>
<p>Why was it the same? In our case, Postman generated a set of sensible defaults. If we omit them, the server will have its own sensible defaults and so the result is more or less the same.</p>
<h5 id="discussion---postman-curl">Discussion - Postman &amp; <code>curl</code></h5>
<ul>
<li>If Postman can generate code for <code>curl</code> and other tools, what does that tell us about Postman?</li>
</ul>
<h4 id="xmlhttprequest---time-api">XMLHttpRequest - Time API</h4>
<p>Now let’s go into the browser world, which is more useful for creating web apps.</p>
<p>First, we will use the original interface, <code>XMLHttpRequest</code> which was added to JavaScript to allow the original background requests commonly called <em>AJAX</em>. It is a little awkward to use.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">function</span> <span class="at">reqListener</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>.<span class="at">responseText</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">let</span> oReq <span class="op">=</span> <span class="kw">new</span> <span class="at">XMLHttpRequest</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="va">oReq</span>.<span class="at">addEventListener</span>(<span class="st">&#39;load&#39;</span><span class="op">,</span> reqListener)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="va">oReq</span>.<span class="at">open</span>(<span class="st">&#39;GET&#39;</span><span class="op">,</span> <span class="st">&#39;https://worldtimeapi.org/api/ip&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="va">oReq</span>.<span class="at">send</span>()<span class="op">;</span></a></code></pre></div>
<p>If correct, you should see the result:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">Object <span class="op">{</span> <span class="dt">week_number</span><span class="op">:</span> <span class="dv">47</span><span class="op">,</span> <span class="dt">utc_offset</span><span class="op">:</span> <span class="st">&quot;-08:00&quot;</span><span class="op">,</span> <span class="dt">utc_datetime</span><span class="op">:</span> <span class="st">&quot;2019-11-20T19:17:12.777523+00:00&quot;</span><span class="op">,</span> <span class="dt">unixtime</span><span class="op">:</span> <span class="dv">1574277432</span><span class="op">,</span> <span class="dt">timezone</span><span class="op">:</span> <span class="st">&quot;America/Los_Angeles&quot;</span><span class="op">,</span> <span class="dt">raw_offset</span><span class="op">:</span> <span class="dv">-28800</span><span class="op">,</span> <span class="dt">dst_until</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">dst_offset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">dst_from</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">dst</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> … <span class="op">}</span></a></code></pre></div>
<h4 id="window.fetch---time-api"><code>window.fetch</code> - Time API</h4>
<p>Newer browsers expose an interface called <code>fetch</code> that is much easier to use and leverages native <code>Promise</code> for simpler processing of the result. And since it is built-in you don’t need to add any libraries to use it in the browser.</p>
<p>Let’s try it out!</p>
<ul>
<li>Open <a href="https://worldtimeapi.org/">https://worldtimeapi.org/</a> in your browser</li>
<li>Open the Developer console</li>
<li><code>response = await fetch('https://worldtimeapi.org/api/ip')</code></li>
<li>Once the promise resolves, response will contain a JavaScript object representing the response from the server</li>
<li>To see the body as like above, execute <code>await response.json()</code></li>
</ul>
<h5 id="fetch---discussion-questions">fetch - Discussion Questions</h5>
<ul>
<li>Notice that even retrieving the body uses Promises (not the <code>await</code>). What are some reasons this might be the way it was designed?</li>
<li>Usually you need to be inside an <code>async</code> function to use <code>await</code>? Why didn’t we need to worry about that here?</li>
</ul>
<h5 id="fetch---browser-compatibility">fetch - Browser Compatibility</h5>
<p><a href="https://caniuse.com/#feat=fetch">https://caniuse.com/#feat=fetch</a></p>
<p>Almost all modern browsers support <code>fetch</code>. Unless your app needs to support IE11, then it’s safe to use. Even then, you can polyfill it, e.g. <a href="https://github.github.io/fetch/">Github’s polyfill</a>.</p>
<h3 id="common-mistakes-misconceptions">Common Mistakes / Misconceptions</h3>
<p>Open a new tab to try to issue the same <code>fetch</code> command.</p>
<ul>
<li>Open a new tab to blank or google.com in your browser</li>
<li>Open the Developer console</li>
<li><code>response = await fetch('https://worldtimeapi.org/api/ip')</code></li>
<li>Once the promise resolves, response will contain a JavaScript object representing the response from the server</li>
<li>To see the body as like above, execute <code>await response.json()</code></li>
</ul>
<p>What happens?</p>
<ul>
<li><a href="https://twitter.com/b0rk/status/1162392625057583104">b0rk explains CORS</a></li>
<li><a href="https://medium.com/netscape/hacking-it-out-when-cors-wont-let-you-be-great-35f6206cc646">Hacking It Out: When CORS won’t let you be great</a></li>
</ul>
<p>To keep things simple, for this example, we just load the same origin, worldtimeapi.org, so we didn’t have to worry about it.</p>
<h3 id="http.request-in-node"><code>http.request</code> in Node</h3>
<p>There are too many HTTP libraries to count in Node, but there is one that is built-in that we’ll use.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> options <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">hostname</span><span class="op">:</span> <span class="st">&#39;worldtimeapi.org&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">port</span><span class="op">:</span> <span class="dv">443</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/api/ip&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="kw">const</span> req <span class="op">=</span> <span class="va">https</span>.<span class="at">request</span>(options<span class="op">,</span> (res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`statusCode: </span><span class="sc">${</span><span class="va">res</span>.<span class="at">statusCode</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="va">res</span>.<span class="at">on</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="va">process</span>.<span class="va">stdout</span>.<span class="at">write</span>(d)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="va">req</span>.<span class="at">end</span>()<span class="op">;</span></a></code></pre></div>
<h3 id="guided-practice">Guided Practice</h3>
<p>fetch is a standard added by browsers but if you like it, it’s also available as a package for node. Let’s use it!</p>
<ul>
<li>npm install –save node-fetch</li>
<li>open node REPL</li>
<li>require(‘node-fetch’)</li>
<li>Run the same command from fetch in the browser but in your node repl</li>
</ul>
<h3 id="independent-practice">Independent Practice</h3>
<p>Since there are tons of libraries out there, now’s a great time to try a few and see what you like/dislike about them compared to those we used above.</p>
<h4 id="exercise">Exercise</h4>
<ul>
<li>Choose 2 libraries from the above article and take a few notes comparing them.</li>
<li>Which was your most favorite of the 5 + 2? Your <em>least favorite</em>?</li>
</ul>
<h4 id="discussion-question">Discussion Question</h4>
<ul>
<li>Why would you pick one way to make a request over another?</li>
<li>What affordances to higher-level libraries give us? What does “higher-level library” mean?</li>
<li>Aside from ease of use from an engineer perspective, what other pros/cons would a software team use to choose an HTTP library for their project?</li>
</ul>
<h3 id="check-for-understanding">Check for Understanding</h3>
<p>Sync up with your pair or another apprentice who is available and go through the following exercises.</p>
<h4 id="discuss-your-mostleast-favorite-tools-from-this-list">Discuss Your Most/Least Favorite Tools from this List</h4>
<ul>
<li>Did either of you choose the same one?</li>
</ul>
<h3 id="supplemental-materials">Supplemental Materials</h3>
<ul>
<li><a href="https://github.com/axios/axios">Axios</a> - a popular HTTP client library for Node</li>
</ul>
