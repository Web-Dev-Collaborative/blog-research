<h1 id="database-migrations">Database Migrations</h1>
<h3 id="projected-time">Projected Time</h3>
<p>60 - 80 minutes</p>
<ul>
<li>Slideshow - 15 min</li>
<li>Guided Practice - 20 min</li>
<li>Independent Practice - 20 min</li>
<li>Challenge - 15 min</li>
<li>Check for Understanding - 5 min</li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li><a href="/databases/relational-databases.md">Relational Databases</a></li>
</ul>
<h3 id="motivation">Motivation</h3>
<p>Understand how to change the schema of a database table. This includes operations to add, remove, and modify fields.</p>
<p>Making changes to a database is often necessary as an application evolves. While some database changes require creating or deleting tables, others require modifying an existing table (called a database migration).</p>
<p><strong>Which companies use Database Migration?</strong></p>
<ul>
<li>Many top companies uses database migration for maintaining and operating the database. Some of them are mentioned below along with the description in links:
<ul>
<li><a href="https://mashable.com/2011/12/15/facebook-timeline-mysql/?europe=true">Facebook</a></li>
<li><a href="https://blog.twitter.com/engineering/en_us/a/2015/another-look-at-mysql-at-twitter-and-incubating-mysos.html">Twitter</a></li>
<li><a href="http://download.nust.na/pub6/mysql/tech-resources/articles/mysqluc-2007.html">YouTube</a></li>
</ul></li>
</ul>
<h3 id="objective">Objective</h3>
<p><strong>Apprentices will be able to:</strong></p>
<ul>
<li>Add a field to a table</li>
<li>Remove a field from a table</li>
<li>Change the properties of a field (name, data type)</li>
<li>Change the name of a table</li>
<li>Know what database transactions are and when to apply them</li>
</ul>
<h3 id="materials">Materials</h3>
<ul>
<li><a href="https://docs.google.com/presentation/d/118Fg5gaMPJBQdZV8n9dcAiYLyX5BseVUcJ1fSANdm4E/edit#slide=id.g4032745045_0_3">Database Migrations Slides</a></li>
<li><a href="http://sqlfiddle.com">SQL Fiddle tool</a></li>
</ul>
<h3 id="lesson">Lesson</h3>
<p>Read through lesson slides <a href="https://docs.google.com/presentation/d/118Fg5gaMPJBQdZV8n9dcAiYLyX5BseVUcJ1fSANdm4E/edit#slide=id.g4032745045_0_3">Database Migrations</a>.</p>
<h3 id="common-mistakes-misconceptions">Common Mistakes / Misconceptions</h3>
<p>Make sure to backup your database before running a migration. If you’ve made a mistake in your SQL command (e.g. deleted incorrect field), reverting to a database back-up will allow you to easily get back to the previous state where your data is intact.</p>
<p>To ensure that your migration works correctly, it is a good idea to apply it to a fake dataset first.</p>
<p>Make sure to not slow down the database for other users during a migration. Migrations on large tables can be slow, and when migrations are in-progress, any other changes to modify the table are blocked until the migration finishes. It is a good idea to apply migrations during a low-traffic time, so it is the least disruptive to users.</p>
<p>You should almost always use transactions in a migration. This is especially important when you are doing operations that add or remove columns from the table.</p>
<p>Use transactions only when it’s important that separate SQL commands succeed or fail as a unit. If you use transactions when they are not needed, it will add unnecessary complexity to your SQL code and hurt performance.</p>
<h3 id="guided-practice">Guided Practice</h3>
<p>Imagine you built a website to track the user’s physical activity. Information about each user is stored in a database table called <em>account</em>, and every time a new user signs up from the signup page, a new row is added to the table.</p>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>email</th>
<th>pet</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Jeff</td>
<td>abcd@gmail.com</td>
<td>siberian cat</td>
</tr>
<tr class="even">
<td>2</td>
<td>Sarah</td>
<td>helloworld@gmail.com</td>
<td>russian blue</td>
</tr>
</tbody>
</table>
<p>On the signup webpage you want to:</p>
<ul>
<li>include a new field for phone number</li>
<li>remove the field for pet (unnecessary info to collect and many people don’t have pets)</li>
</ul>
<p>To support these changes, you need to modify the way data is stored in the <em>account</em> table. This includes adding a column for <strong>phone</strong> and dropping the <strong>pet</strong> column.</p>
<ul>
<li>Write a SQL command to generate the account table, and populate it with the sample data</li>
<li>Apply a migration to modify the table</li>
<li>Insert a new user Alexandria with:
<ul>
<li>email orange1777@gmail.com</li>
<li>phone number <em>(515) 525-5151</em> (stored as INT)</li>
</ul></li>
</ul>
<h3 id="independent-practice">Independent Practice</h3>
<p><strong>Activity #1</strong> Create your own table with at least four columns. One of the columns should be type VARCHAR(5).</p>
<p>Populate the table with three entries.</p>
<p><strong>Activity #2</strong> Think about how you want the table to change. Are there additional columns you’d like to add or ones you want to remove?</p>
<p>Run a migration to add one column and delete one column. Also, change the field with type VARCHAR(5) to VARCHAR(50). (Don’t forget to run as part of a transaction!)</p>
<h3 id="challenge">Challenge</h3>
<p>Practice project:</p>
<ul>
<li><a href="https://www.khanacademy.org/computing/computer-programming/sql/modifying-databases-with-sql/p/challenge-clothing-alterations">“Clothing alterations” (Khan Academy)</a></li>
</ul>
<h4 id="supplemental-resources">Supplemental Resources</h4>
<ul>
<li><a href="https://www.tutorialspoint.com/sql/sql-alter-command.htm">TutorialsPoint</a></li>
<li><a href="https://www.youtube.com/watch?v=vDr2DZeU5mY">The Bad Tutorials video on youtube</a></li>
<li><a href="https://www.khanacademy.org/computing/computer-programming/sql/modifying-databases-with-sql/p/altering-tables-after-creation">Khan academy video</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/static/tutorial-transactions.html">Transactions</a></li>
</ul>
<p>Further learning: <a href="http://www.brunton-spall.co.uk/post/2014/05/06/database-migrations-done-right/">Database Migrations Done Right</a></p>
<h3 id="check-for-understanding">Check for Understanding</h3>
<ul>
<li><a href="https://www.quia.com/quiz/222978.html?AP_rand=168283296">Grasp SQL Quiz</a></li>
</ul>
