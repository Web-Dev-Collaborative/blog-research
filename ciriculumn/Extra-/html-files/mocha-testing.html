<h1 id="adding-chaimocha-tests-to-your-project">Adding Chai/Mocha Tests to your project</h1>
<h3 id="projected-time">Projected Time</h3>
<p>45 minutes</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>Here are links to lessons that should be completed before this lesson:</p>
<ul>
<li><a href="../testing-and-tdd/testing-and-tdd.md">Intro to Testing and TDD</a></li>
<li><a href="../testing-and-tdd/jasmine-testing.md">Jasmine Testing</a></li>
</ul>
<h3 id="motivation">Motivation</h3>
<p>Learn to use another testing tool for flexibility.</p>
<h3 id="objectives">Objectives</h3>
<p><em>Participants will be able to:</em></p>
<ul>
<li>Create a testing structure in Mocha</li>
<li>Create assertion functions using Mocha / Chai</li>
<li>Generate, display and watch tests</li>
</ul>
<h3 id="specific-things-to-learn">Specific Things to Learn</h3>
<ul>
<li><a href="https://mochajs.org/">Mocha</a>
<ul>
<li>install Mocha</li>
<li>create tests using assert</li>
</ul></li>
<li><a href="https://www.chaijs.com/">Chai</a>
<ul>
<li>install Chai</li>
<li>use Chai for assertions</li>
</ul></li>
</ul>
<h3 id="materials">Materials</h3>
<ul>
<li><a href="https://docs.google.com/presentation/d/1JGpTdQaYuBxbH3QTnZvTW4-ozYD_jf9OTifUzv-MIOg/edit?usp=sharing">Mocha/Chai Testing Slideshow</a></li>
</ul>
<h3 id="lesson">Lesson</h3>
<h4 id="mocha-vs.-jasmine">Mocha vs. Jasmine</h4>
<p>Both Mocha and Jasmine are popular JavaScript testing frameworks for writing BDD (Behavior-Driven Development) tests. So, why might you choose one over the other?</p>
<p><em>Jasmine:</em> Jasmine attempts to provide everything that a developer would need in a testing framework. It does not need the browser, the DOM, or any JavaScript framework to work, so it’s simple to get up and running.</p>
<p><em>Mocha:</em> Mocha does not claim to be a complete testing framework. It is intended to be extended with other frameworks, such as Chai. People like it for its flexibility. It runs on Node and in the browser.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">//mocha</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="at">expect</span>(<span class="st">&#39;bunny&#39;</span>).<span class="va">to</span>.<span class="va">not</span>.<span class="at">equal</span>(<span class="st">&#39;rabbit&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">//jasmine</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="at">expect</span>(<span class="st">&#39;bunny&#39;</span>).<span class="va">not</span>.<span class="at">toEqual</span>(<span class="st">&#39;rabbit&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>At the end of the day, both Jasmine and Mocha are popular testing frameworks that many companies use. There is no wrong answer: the testing framework that you choose for projects is up to you.</p>
<h4 id="mocha-test">Mocha Test</h4>
<p>Let’s get started by setting up a new project with Mocha.</p>
<p><em>Create a new project</em></p>
<ul>
<li><code>mkdir mocha-practice</code> - create a folder for your new project</li>
<li><code>cd mocha-practice</code> - change directories to that folder</li>
<li><code>npm init --yes</code> - make the <code>package.json</code> file</li>
</ul>
<p><em>Install Mocha</em></p>
<ul>
<li><code>npm install --save-dev mocha</code></li>
<li>Note: remember the discussion of “global” vs. “local” installation in the <a href="../testing-and-tdd/jasmine-testing.md">Jasmine lesson</a>? In this case, we are opting to install Mocha <em>locally</em> first. This ensures that everyone running the project will use the same version of Mocha. However, you can also install Mocha globally, if you like. <a href="https://mochajs.org/#installation">See docs</a>.</li>
</ul>
<p><em>Create Test Files</em></p>
<ul>
<li><code>mkdir test</code> - your tests should live in this folder, so that mocha knows where to find them</li>
<li><code>touch test/myTest.js</code> - add a test file to the <code>test</code> directory</li>
</ul>
<p><em>Start Test</em></p>
<ul>
<li>To run Mocha from the local installation, edit the “test” line in the “package.json” file to say: <code>"test": "mocha"</code></li>
<li>Run <code>npm test</code>! Since you have no tests written yet, you should see something like this:</li>
</ul>
<pre><code>&gt; mocha



  0 passing (1ms)</code></pre>
<p><em>Syntax</em></p>
<ul>
<li><code>describe</code> and <code>it</code> functions work like Jasmine’s similarly named functions:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> assert <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;assert&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="at">describe</span>(<span class="st">&#39;Mocha String Test&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="at">it</span>(<span class="st">&#39;should return the exact number of characters in a string&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="va">assert</span>.<span class="at">equal</span>(<span class="st">&#39;Hello&#39;</span>.<span class="at">length</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span> <span class="co">// this line will fail</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="at">it</span>(<span class="st">&#39;should return first character of the string&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="va">assert</span>.<span class="at">equal</span>(<span class="st">&#39;Hello&#39;</span>.<span class="at">charAt</span>(<span class="dv">0</span>)<span class="op">,</span> <span class="st">&#39;H&#39;</span>)<span class="op">;</span> <span class="co">// this line will pass</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>Add the above code to your <code>test.js</code> file, and run the tests again. You should now see one passing test, and one failing test.</li>
</ul>
<pre><code>Mocha String Test
  1) should return the exact number of characters in a string
  ✓ should return first character of the string


1 passing (8ms)
1 failing

1) Mocha String Test
     should return the exact number of characters in a string:

    AssertionError [ERR_ASSERTION]: 5 == 4
    + expected - actual

    -5
    +4

    at Context.&lt;anonymous&gt; (test/myTest.js:5:16)</code></pre>
<ul>
<li>When calling <code>assert.equal(a, b)</code> mocha expects the values to be equivalent, or else the test will fail.</li>
<li>If you need to test asynchronous code, Mocha makes it very simple using callbacks. All you need to do is pass a callback function (usually named <code>done</code>) to <code>it</code> function and invoke the callback function after your test is complete.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> assert <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;assert&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">function</span> <span class="at">asyncFunction</span>(stringToTest<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="at">callback</span>(<span class="va">stringToTest</span>.<span class="at">charAt</span>(<span class="dv">0</span>) <span class="op">===</span> <span class="st">&#39;H&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="op">},</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">// Note: setTimeout has been used to simulate the async behavior</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">// Warn: Using setTimeout is not the best practice since it&#39;s execution time is unpredictable or unreliable</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="at">describe</span>(<span class="st">&#39;Mocha String Test&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="at">it</span>(<span class="st">&#39;should return first character of the string&#39;</span><span class="op">,</span> <span class="kw">function</span>(done) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="at">asyncFunction</span>(<span class="st">&#39;Hello&#39;</span><span class="op">,</span> <span class="kw">function</span>(isValid) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-15" title="15">      <span class="va">assert</span>.<span class="at">equal</span>(isValid<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-16" title="16">      <span class="at">done</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>To learn more about testing asynchronous code with Mocha, see the <a href="https://mochajs.org/#asynchronous-code">docs</a>.</p>
<ul>
<li>Mocha will allow you, the developer, to use other assert libraries, like Chai! This gives you choice and flexibility.</li>
</ul>
<h4 id="chai-test">Chai Test</h4>
<p>Let’s install Chai, an assertion library commonly used with Mocha!</p>
<p><em>install Chai</em></p>
<ul>
<li><code>npm install --save-dev chai</code></li>
</ul>
<p><em>setting up Chai</em></p>
<ul>
<li>You can now use Chai within your Mocha tests to make assertions. Chai provides a few different styles for making assertions. Let’s take a quick look at each of them!</li>
<li><a href="https://www.chaijs.com/guide/styles/#assert"><code>assert</code></a>: These statements typically take two arguments, and “assert” that something is truthful.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> assert <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;chai&#39;</span>).<span class="at">assert</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">const</span> foo <span class="op">=</span> <span class="st">&#39;foo&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">// Passing</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="va">assert</span>.<span class="at">typeOf</span>(foo<span class="op">,</span> <span class="st">&#39;string&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">// Failing - note that the third argument is an optional error message</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="va">assert</span>.<span class="at">equal</span>(foo<span class="op">,</span> <span class="st">&#39;bar&#39;</span><span class="op">,</span> <span class="st">&#39;foo equal `bar`&#39;</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li><a href="https://www.chaijs.com/guide/styles/#expect"><code>expect</code></a>: “Expect” statements chain together assertions that feel like natural language</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> expect <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;chai&#39;</span>).<span class="at">expect</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">const</span> foo <span class="op">=</span> <span class="st">&#39;foo&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">// Passing</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="at">expect</span>(foo).<span class="va">to</span>.<span class="va">be</span>.<span class="at">a</span>(<span class="st">&#39;string&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">// Failing</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="at">expect</span>(foo).<span class="va">to</span>.<span class="at">equal</span>(<span class="st">&#39;bar&#39;</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li><a href="https://www.chaijs.com/guide/styles/#should"><code>should</code></a>: “Should” statements are similar to “expect”, but start with the start each chain with a <code>should</code></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> should <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;chai&#39;</span>).<span class="at">should</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">const</span> foo <span class="op">=</span> <span class="st">&#39;foo&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">// Passing</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="va">foo</span>.<span class="va">should</span>.<span class="va">be</span>.<span class="at">a</span>(<span class="st">&#39;string&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">// Failing</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="va">foo</span>.<span class="va">should</span>.<span class="at">equal</span>(<span class="st">&#39;bar&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Note: If you like this style, you can use the <a href="https://www.npmjs.com/package/should">should library</a> with Mocha, as that is a common reason to use it over Jasmine.</p>
<ul>
<li>As you may have noticed, Chai provides a lot of flexibility in how you structure assertions! For personal projects, choose the style that you prefer. When working in an existing codebase with Chai, use the style of the surrounding code.</li>
</ul>
<h3 id="common-mistakes-misconceptions">Common Mistakes / Misconceptions</h3>
<ol type="1">
<li>Not all testing libraries are created the same. These libraries have different and overlapping functionality.
<ul>
<li>Jasmine is an out-of-the-box library that has test structure, assertions, displays test results, and spies.</li>
<li>Mocha is an extensible testing framework that provides a lot of flexibility</li>
<li>Chai is an assertion library that can be used with Mocha.</li>
</ul></li>
</ol>
<h3 id="guided-practice">Guided Practice</h3>
<p><em>FizzBuzz (again!)</em> Within your Mocha project, re-write the FizzBuzz test from the <a href="../testing-and-tdd/jasmine-testing.md#guided-practice">Jasmine Testing exercises</a>, using <code>assert</code> syntax. Refer to the <a href="https://www.chaijs.com/api/assert/">docs</a> as needed to find the matchers you need. Ensure that the test passes.</p>
<details>
<summary>Check your work</summary>
<pre><code>
const fizzBuzz = require('../src/fizzBuzz');
const assert = require('chai').assert;

describe("fizzBuzz", function() {
it("should be defined", function() {
assert.exists(fizzBuzz);
});

it("should return 'fizz' when given a multiple of 3", function() {
assert(fizzBuzz(3), "fizz");
assert(fizzBuzz(6), "fizz");
});

it("should return 'buzz' when given a multiple of 5", function() {
assert(fizzBuzz(5), "buzz");
assert(fizzBuzz(10), "buzz");
});

it("should return 'fizzbuzz' when given a multiple of 3 and 5", function() {
assert(fizzBuzz(15), "fizzbuzz");
assert(fizzBuzz(30), "fizzbuzz");
});
});
</code></pre>
</details>
<h3 id="independent-practice">Independent Practice</h3>
<ol type="1">
<li>Re-implement Challenge 1, “Convert Inches to Meters” from <a href="../javascript/basic-js-practice.md">Basic JS Practice</a> in a TDD Style. Use Chai’s <code>expect</code> style assertions, referring to the <a href="https://www.chaijs.com/api/bdd/">docs</a> as needed. Add assertions that:
<ul>
<li>The values returned by <code>metersToInches</code> are floats</li>
<li>The values returned by <code>metersToInches</code> have the correct results:</li>
</ul></li>
</ol>
<table>
<thead>
<tr class="header">
<th>input</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>metersToInches(0)</td>
<td>0</td>
</tr>
<tr class="even">
<td>metersToInches(1)</td>
<td>39.3701</td>
</tr>
<tr class="odd">
<td>metersToInches(1.5)</td>
<td>59.05515</td>
</tr>
<tr class="even">
<td>metersToInches(15.6)</td>
<td>614.17356</td>
</tr>
</tbody>
</table>
<ol start="2" type="1">
<li>We’re going to define a JavaScript object, TDD style! Use any Chai assertion style. After each new test, make the test pass.
<ul>
<li>In a new test file, define an empty object. We’ll add keys and values to the object as we write our tests.</li>
<li>Write a test that the object has all keys ‘cats’, ‘dogs’, and ‘reptiles’.</li>
<li>Write a test that the object does not have the property ‘rabbits’,</li>
<li>Write a test that the value at ‘cats’ is an array</li>
<li>Write a test that the ‘cats’ array contains contains the string “Mr. Snuffalufagus”</li>
<li>Write a test that the value at ‘dogs’ equals <code>['Fido', 'Fluffy', 'Roxy']</code> (Hint: if the <code>equal</code> assertion fails, take a look at <a href="https://medium.com/building-ibotta/testing-arrays-and-objects-with-chai-js-4b372310fe6d">this article</a>)</li>
<li>Write a test that ‘lizards’ is an empty array</li>
</ul></li>
</ol>
<h3 id="challenge">Challenge</h3>
<p>Do the <a href="https://github.com/mochajs/mocha/tree/master/test">Mocha</a> and <a href="https://github.com/chaijs/chai/tree/master/test">Chai</a> projects have their own internal tests? Read them and see how they are used.</p>
<h3 id="supplemental-materials">Supplemental Materials</h3>
<ul>
<li><p>Chai and Mocha blog post, <a href="https://codeburst.io/javascript-unit-testing-using-mocha-and-chai-1d97d9f18e71">link</a></p>
<ul>
<li>Accompanied by this github repo of tests, <a href="https://github.com/npatro/javascript-unit-testing-with-mocha">link</a></li>
<li>A quick and complete guide to Mocha testing" by Glad Chinda, <a href="https://blog.logrocket.com/a-quick-and-complete-guide-to-mocha-testing-d0e0ea09f09d">link</a></li>
</ul></li>
<li>Video series by “WebDevJourney”
<ul>
<li><a href="https://youtu.be/2q62EhBy0sE">Node JS - Authentication - Login/Logout Mocha Testing by Web Dev Journey</a></li>
<li>github repo with mocha test included, <a href="https://github.com/webdevjourneyWDJ/Todo-API">link</a>.</li>
</ul></li>
</ul>
<h3 id="check-for-understanding">Check for Understanding</h3>
<p><em>Question:</em> What are Mocha and Chai, and how do they work in your project? How do they differ from Jasmine?</p>
<p><em>Exercise:</em> Every student should pick a Chai assertion, like <code>.to.have.lengthOf</code>. Describe that matcher to the class and how it should be used.</p>
